module controller(input start, clock, reset, enablecircuit, output reg ready, ldx, selx, selrom, encount, initcount, initt, ldt, initr, ldr, addci, selt);
	reg [3:0] ps, ns;
	parameter [3:0] idle = 0, init = 1, load = 2, mult1 = 3, mult2 = 4, mult3 = 5, mult4 = 6, compare = 7, add = 8;
	always@(ps, start, enablecircuit)begin
		ns = idle;
		case(ps)
			idle: begin ns = start ? init : idle; ready = 1;end
			init: begin ns = start ? init : load; initt = 1; initr = 1; initcount = 1; encount = 0; addci = 0; ready = 0;end
			load: begin ns = mult1; ldx = 1; ldt = 0; ldr = 0;end
			mult1: begin ns = mult2; ldt = 1; selx = 1; selrom = 0; addci = ~addci;end
			mult2: ns = mult3;
			mult3: begin ns = mult4; selrom = 1; selx = 0; encount = 1;end
			mult4: ns = compare;
			compare: begin ns = enablecircuit ? add : idle; encount = 0; ldt = 0;end
			add: begin ns = mult1; ldr = 1; selt = addci;end
			default: ns = idle;
		endcase
	end
	always@(posedge clock, posedge reset)begin
		if (reset)
			ps <= idle;
		else
			ps <= ns;
	end
endmodule